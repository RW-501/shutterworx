<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ShutterWorx - Capturing moments through stunning photography. Explore our gallery, book a session, and see what our clients say.">
    <meta name="keywords" content="photography, ShutterWorx, portrait, events, book a session">
    <meta name="author" content="ShutterWorx">
    
    <!-- Open Graph Meta Tags for Social Media Sharing -->
    <meta property="og:title" content="ShutterWorx">
    <meta property="og:description" content="Capturing Moments, One Click at a Time">
    <meta property="og:image" content="path/to/default-image.jpg"> <!-- Update with a real image URL -->
    <meta property="og:url" content="https://www.rawphotography.com"> <!-- Update with your actual URL -->
    
    <title>ShutterWorx</title>
    <link rel="stylesheet" href="https://shutterworx.co/css/main.css">
    <link rel="icon" href="path/to/favicon.ico" type="image/x-icon"> <!-- Add a favicon for branding -->

    <style>


.gallery-section,
.testimonials-section {
    padding: 3em 1em;
    background-color: #f9f9f9;
    text-align: center;
}

.gallery-description,
.testimonials-description {
    color: #666;
    margin-bottom: 1.5em;
    font-size: 1rem;
}

.gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1em;
    margin-bottom: 2em;
}

.gallery-grid img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    transition: transform 0.3s;
}

.gallery-grid img:hover {
    transform: scale(1.05);
}

.cta-buttons {
    display: flex;
    justify-content: center;
    gap: 1em;
}

.btn {
    padding: 0.75em 1.5em;
    font-size: 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.btn-primary {
    background-color: #007bff;
    color: #fff;
}

.btn-secondary {
    background-color: #6c757d;
    color: #fff;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary:hover {
    background-color: #5a6268;
}

.testimonial-list {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 1.5em 0;
}

.testimonial-item {
    background-color: #fff;
    border-radius: 8px;
    padding: 1.5em;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin: 0.5em 0;
    max-width: 600px;
    width: 100%;
    transition: transform 0.3s;
}

.testimonial-item:hover {
    transform: translateY(-5px);
}

.contact-section {
    margin: 0 auto;
    padding: 2em;
    background-color: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.contact-description {
    color: #666;
    font-size: 1rem;
    margin-bottom: 1.5em;
}

.contact-form .form-group {
    margin-bottom: 1.5em;
}

.contact-form label {
    display: block;
    font-weight: bold;
    margin-bottom: 0.5em;
}

.contact-form .required {
    color: red;
    font-size: 0.9em;
}


.contact-form input,
.contact-form textarea {
    width: 100%;
    padding: 0.75em;
    font-size: 1em;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
    resize: none;
}

.contact-form input:focus,
.contact-form textarea:focus {
    border-color: #007bff;
    outline: none;
}

.contact-form .btn-primary {
    padding: 0.75em 2em;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 4px;
    font-size: 1em;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.contact-form .btn-primary:hover {
    background-color: #0056b3;
}

.form-response {
    margin-top: 1em;
    font-size: 0.9em;
    color: #007bff;
}

#private-photos-access {
    padding: 2em;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 8px;
    text-align: center;
}

#private-photos-access h2 {
    margin-bottom: 1em;
}

#access-code {
    padding: 0.5em;
    width: 60%;
    max-width: 300px;
    margin-right: 0.5em;
}
#private-photos-access input {
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
}

#private-photos-access input:focus {
    border-color: #007bff;
    outline: none;
}
button {
    padding: 0.5em 1em;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #0056b3;
}

.message {
    margin-top: 1em;
    font-size: 1em;
}

section {
margin: 2rem auto;
padding: 2em;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

        /* Lightbox Styles */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
        }




    </style>
</head>
<body>



    <!-- Header -->
<header id="site-header">
    <h1 id="header-title">Welcome to My Photography Site</h1>
    <p id="header-subtitle">Capturing Moments, One Click at a Time</p>

    <!-- Toggle Button for Collapsible Navigation -->
    <button id="menu-toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="nav-menu">
        <span class="bar top-bar"></span>
        <span class="bar middle-bar"></span>
        <span class="bar bottom-bar"></span>
    </button>

    <nav id="nav-menu" aria-hidden="true">
        <ul>
            <li><a href="index">Home</a></li>
            <li><a href="events">Events</a></li>
            <li><a href="portfolio">Portfolio</a></li>
            <li><a href="contact">Contact</a></li>
        </ul>
    </nav>
</header>


<main>
    
<!-- Gallery Section -->
<section id="gallery" class="gallery-section">
    <h2 id="gallery-title">Gallery</h2>
    <p class="gallery-description">Explore our collection of stunning images that capture the essence of our work.</p>
    <div id="gallery-grid" class="gallery-grid">
        <!-- Dynamically loaded images will be inserted here -->
    </div>
    <div id="cta-buttons" class="cta-buttons">
        <button id="book-session-btn" class="btn btn-primary" onclick="location.href='contact?book'">Book a Session</button>
        <button id="view-eventsbtn" class="btn btn-secondary" onclick="location.href='events'">View Events</button>
    </div>
</section>



<!-- Testimonials Section -->
<section id="testimonials" class="testimonials-section">
    <h2 id="testimonials-title">What Our Clients Say</h2>
    <p class="testimonials-description">Hear directly from our clients about their experiences with us.</p>
    <div id="testimonial-list" class="testimonial-list">
        <!-- Testimonials will be inserted here -->
    </div>
    <button id="view-all-testimonials-btn" class="btn btn-secondary" onclick="location.href='testimonials'">View All Testimonials</button>
</section>

<!-- Private Photos Access Section -->
<section id="private-photos-access">
    <h2>Access Your Photos</h2>
    <form id="access-code-form" onsubmit="return handleAccessCode(event);">
        <label for="access-code">Enter Access Code:</label>
        <input type="text" id="access-code" required placeholder="Enter your code here">
        <button >View Photos</button>
    </form>
    <div id="access-message" class="message"></div>
</section>

    <!-- Contact Form Section -->
    <section id="contact" aria-labelledby="contact-title" class="contact-section">
        <h2 id="contact-title">Get in Touch</h2>
        <p class="contact-description">Weâ€™d love to hear from you! Please fill out the form below and our team will get back to you as soon as possible.</p>
        
        <form id="contactForm" class="contact-form">
            <div class="form-group">
                <label for="name">Name <span class="required">*</span></label>
                <input type="text" id="name" placeholder="Your full name" required aria-required="true">
            </div>
    
            <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" placeholder="yourname@example.com" required aria-required="true">
            </div>
    
            <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" id="phone" placeholder="Optional">
            </div>
    
            <div class="form-group">
                <label for="message">Message <span class="required">*</span></label>
                <textarea id="message" rows="5" placeholder="Type your message here..." required aria-required="true"></textarea>
            </div>
    
            <div id="formResponse" class="form-response"></div>
    
            <button id="send-message-btn" type="submit" class="btn btn-primary">Send Message</button>
        </form>
    </section>
    

    <!-- Lightbox for images -->
    <div id="lightbox" class="lightbox">
        <span class="close" onclick="closeLightbox()">&times;</span>
        <img class="lightbox-content" id="lightbox-image">
    </div>
</main>


<!-- Footer -->
<footer id="site-footer" class="footer">
    <div class="footer-container">
        <div class="social-icons">
            <!-- Social media links dynamically added here -->
            <a href="https://facebook.com" target="_blank" class="social-icon" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="https://instagram.com" target="_blank" class="social-icon" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://twitter.com" target="_blank" class="social-icon" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="https://linkedin.com" target="_blank" class="social-icon" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
        </div>
        <div class="footer-body">
            <p>&copy; 2024 My Photography Site. All Rights Reserved.</p>
            <p class="footer-links">
                <small>
                    <a href="https://shutterworx.co/privacy" class="footer-link">Privacy Policy</a> |
                    <a href="https://shutterworx.co/terms" class="footer-link">Terms of Service</a>
                </small>
            </p>
            <p><a href="https://shutterworx.co/views/admin-login" class="footer-link">Admin Login</a></p>
        </div>
    </div>
</footer>


<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">



    <script type="module">
        import {  db, doc,getDoc, query, updateDoc,
    setDoc,     signInWithPopup,
    GoogleAuthProvider,
    FacebookAuthProvider,
    OAuthProvider, arrayUnion ,
    signOut, addDoc ,
    onAuthStateChanged, increment,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    where, getDocs, storage, collection, auth, analytics  } from 'https://shutterworx.co/js/firebaseConfig.js';





        // Load Gallery
        async function loadGallery() {
    const galleryGrid = document.getElementById("gallery-grid");
    
    // Show loading text or spinner
    const loadingIndicator = document.createElement("p");
    loadingIndicator.innerText = "Loading gallery...";
    galleryGrid.appendChild(loadingIndicator);

    try {
        const q = query(collection(db, "images"), where("isPublic", "==", true));
        const snapshot = await getDocs(q);

        // Clear loading indicator once data is ready
        galleryGrid.removeChild(loadingIndicator);

        // Check if there are images to display
        if (snapshot.empty) {
    const noImagesMessage = document.createElement("p");
    noImagesMessage.className = "no-images-message"; // Add a class for styling
    noImagesMessage.innerText = "No images available in the gallery.";
    
    // Optional: Center the message within the gallery grid
    noImagesMessage.style.textAlign = "center";
    noImagesMessage.style.fontStyle = "italic";
    noImagesMessage.style.color = "#888"; // Subtle color to differentiate

    galleryGrid.appendChild(noImagesMessage);
    return;
}


        // Use DocumentFragment to improve performance
        const fragment = document.createDocumentFragment();

        snapshot.forEach((doc) => {
            const data = doc.data();
            const imgElement = document.createElement("img");
            imgElement.src = data.url; // Adjust based on your structure
            imgElement.alt = data.description || "Gallery Image";
            imgElement.classList.add("gallery-image"); // Optional: for styling
            imgElement.onclick = function () {
                openLightbox(imgElement.src);
            };
            fragment.appendChild(imgElement);
        });

        galleryGrid.appendChild(fragment); // Append all images at once for efficiency

    } catch (error) {
        console.error("Error loading gallery:", error);
        galleryGrid.innerHTML = "<p>Failed to load gallery. Please try again later.</p>";
    }
}


async function loadHomePage() {
  // Reference to the document in Firestore
  const docRef = doc(db, "settings", "home_Page");
  
  try {
    // Get the document snapshot
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();

      // Update gallery section
      document.getElementById("gallery-title").innerText =
        data.galleryTitle || "Gallery";

      // Update testimonials section
      document.getElementById("testimonials-title").innerText =
        data.testimonialsTitle || "What Our Clients Say";

      const testimonialList = document.getElementById("testimonial-list");
      testimonialList.innerHTML = ""; // Clear existing testimonials
      if(data.testimonials){
      data.testimonials.forEach((testimonial) => {
        const div = document.createElement("div");
        div.className = "testimonial-item";
        div.innerText = testimonial; // Add testimonial text
        testimonialList.appendChild(div);
      });
    }else{
        const noTestimonialsDiv = document.createElement("div");
    noTestimonialsDiv.className = "testimonial-item no-testimonial";
    noTestimonialsDiv.innerText = "No testimonials available at the moment.";
    testimonialList.appendChild(noTestimonialsDiv);
    }
      // Update contact section
      document.getElementById("contact-title").innerText =
        data.contactTitle || "Contact Us";
    } else {
      console.log("No such document!");
    }
  } catch (error) {
    console.error("Error loading home page data:", error);
  }
}



    // Initialize Gallery and Testimonials
    async function init() {
        await loadHomePage();
        await loadGallery();
    }


// Sample function to handle the access code
// Function to handle access code validation
async function handleAccessCode(event) { 
    event.preventDefault(); // Prevent the default form submission

    const accessCodeInput = document.getElementById('access-code');
    const accessMessageDiv = document.getElementById('access-message');
    const accessCode = accessCodeInput.value.trim();

    try {
        // Check the events collection for the access code
        const snapshot = await db.collection('events').where('accessCode', '==', accessCode).get();

        if (!snapshot.empty) {
            // If the access code is valid, redirect to the private photos page
            window.location.href = `../events/p=${encodeURIComponent(accessCode)}`;
        } else {
            // If the access code is invalid, show a toast notification
            showToast("Invalid access code. Please try again.", "error");
        }
    } catch (error) {
        // Handle errors during the Firestore query
        console.error("Error checking access code:", error);
        showToast("An error occurred while checking the access code. Please try again.", "error");
    }

    // Clear the input field after submission
    accessCodeInput.value = '';
}

    

let viewStartTime;

// Function to set the last internal page in sessionStorage before navigating
function setInternalPageSource() {
    sessionStorage.setItem('lastInternalPage', window.location.href);
}

// Function to start tracking the view time when the page loads
function startViewTimer() {
    viewStartTime = Date.now();
}



    // Determine the source
    const externalSource = document.referrer && !document.referrer.includes(window.location.origin)
        ? document.referrer
        : null;
    const internalSource = sessionStorage.getItem('lastInternalPage');
    const viewSource = externalSource || internalSource || 'Direct Visit';



    let ipAddress;
let locationData;

document.addEventListener("DOMContentLoaded", async () => {
    try {
        const { ip, location } = await window.userLocationService.getUserIPAndLocation();

        ipAddress = ip;
        locationData = location;
    } catch (error) {
        console.error("Error fetching user IP and location:", error);
    }
});




        // Handle form submission
// Assuming you have initialized Firestore previously
document.getElementById("contactForm").addEventListener("submit", async function (event) {
    event.preventDefault(); // Prevent the default form submission behavior

    window.showLoadingSpinner(false); // Show spinner during processing
    document.getElementById("send-message-btn").disabled = true; // Disable button
document.getElementById("send-message-btn").innerHTML = "Sending..."; // Show loading state

    // Get form values and sanitize them
    const name = sanitizeInput(document.getElementById('name').value);
    const email = sanitizeInput(document.getElementById('email').value);
    const phone = sanitizeInput(document.getElementById('phone').value);
    const message = sanitizeInput(document.getElementById('message').value);

    // Input validation
    if (!isSafeInput(name) || !isSafeInput(email) || !isSafeInput(phone) || !isSafeInput(message)) {
        const formResponse = document.getElementById("formResponse");
        formResponse.textContent = 'Invalid characters detected in form. Please remove any special characters.';
        formResponse.style.color = 'red';
        window.hideLoadingSpinner(); // Hide spinner on validation error
        return;
    }

    // Prepare data for Firestore
    const formData = {
        name,
        email,
        phone,
        message,
        externalSource: externalSource,
        internalSource: internalSource,
        ipAddress: ipAddress,                       // ID of the user or 'guest'
            city: locationData.city,
    zipCode: locationData.zip,
    state: locationData.state,
    country: locationData.country,
        contact_form: "Home Page",
        timestamp: new Date()  // Optional: Add timestamp
    };

    try {
        // Specify the 'messages' collection in the Firestore database
        const messagesCollectionRef = collection(db, 'messages');
        
        // Add the document to the 'messages' collection
        await addDoc(messagesCollectionRef, formData);
        
        // Show success message
        showToast('Message sent successfully!', 'success');
    } catch (error) {
        console.error("Error sending message: ", error);
        const formResponse = document.getElementById("formResponse");
        formResponse.textContent = 'There was an error sending your message. Please try again.';
        formResponse.style.color = 'red';
    } finally {
        window.hideLoadingSpinner(); // Ensure the spinner is hidden after processing
        document.getElementById("send-message-btn").innerHTML = "Sent"; // Show loading state

        // Clear the form
        document.getElementById("contactForm").reset();

        // Clear any previous response messages
        const formResponse = document.getElementById("formResponse");
        formResponse.innerHTML = ""; 
    }
});

    // Run initialization on window load
    window.onload = init;

    
    
</script>
    <script  type="module" src="https://shutterworx.co/js/main.js"></script>
</body>
</html>
